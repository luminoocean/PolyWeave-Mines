<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PolyWeave Mines — Minesweeper</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="controls" role="region" aria-label="Game controls">
    <div class="control-group">
      <label for="msRows">Rows</label>
      <input id="msRows" type="number" min="3" max="60" value="9" />
    </div>

    <div class="control-group">
      <label for="msCols">Cols</label>
      <input id="msCols" type="number" min="3" max="60" value="9" />
    </div>

    <div class="control-group">
      <label for="msMines">Mines</label>
      <input id="msMines" type="number" min="1" value="10" />
    </div>

    <div class="control-group">
      <label for="tilingSelect">Tiling</label>
      <select id="tilingSelect" aria-label="Tiling"></select>
    </div>

    <div class="control-group">
      <label for="adjacencySelect">Adjacency</label>
      <select id="adjacencySelect" aria-label="Adjacency"></select>
    </div>

    <div class="control-group">
      <button id="applyAdjacency" class="ms-btn">Apply adjacency</button>
      <button id="newGame" class="ms-btn primary">New Game</button>
    </div>

    <div style="margin-left:auto; display:flex; gap:8px; align-items:center;">
      <div id="msStatus">Ready</div>
      <button id="msSettingsBtn" class="ms-btn" title="Open settings">Settings</button>
    </div>
  </div>

  <main id="appRoot" role="main" aria-live="polite"></main>

  <!-- Settings modal -->
  <div id="msSettingsModal" class="ms-modal" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="ms-modal-panel" role="document">
      <header class="ms-modal-header">
        <h3>Game settings</h3>
        <button id="msSettingsClose" class="ms-close" aria-label="Close settings">✕</button>
      </header>

      <section class="ms-modal-body">
        <div class="ms-row">
          <label for="sizeSlider">Minefield size (rows & cols)</label>
          <input id="sizeSlider" type="range" min="6" max="36" value="9">
          <span id="sizeValue">9</span>
        </div>

        <div class="ms-row">
          <label><input type="checkbox" id="optShowTriShrink"> Enable triangle shrink slider</label>
        </div>

        <div class="ms-row" id="triShrinkRow" hidden>
          <label for="triShrinkSlider">Triangle shrink (px)</label>
          <input id="triShrinkSlider" type="range" min="0" max="20" value="0">
          <span id="triShrinkValue">0</span>
        </div>

        <div class="ms-row">
          <label><input type="checkbox" id="optShowGapScale"> Enable horizontal gap scale</label>
        </div>

        <div class="ms-row" id="gapScaleRow" hidden>
          <label for="xGapSlider">Horizontal gap scale</label>
          <input id="xGapSlider" type="range" min="0.6" max="1.6" step="0.05" value="1">
          <span id="xGapValue">1.00</span>
        </div>

        <div class="ms-row">
          <label><input type="checkbox" id="optShowExtra"> Show developer controls</label>
        </div>

        <div class="ms-row" id="devControlsRow" hidden>
          <label><input id="msDebugCheckbox" type="checkbox"> Show debug overlay (coords)</label>
        </div>
      </section>

      <footer class="ms-modal-footer">
        <button id="msSettingsApply" class="ms-btn primary">Apply</button>
        <button id="msSettingsCancel" class="ms-btn">Cancel</button>
      </footer>
    </div>
  </div>

  <script src="app.js"></script>

  <script>
  (function(){
    const openBtn = document.getElementById('msSettingsBtn');
    const modal = document.getElementById('msSettingsModal');
    const closeBtn = document.getElementById('msSettingsClose');
    const applyBtn = document.getElementById('msSettingsApply');
    const cancelBtn = document.getElementById('msSettingsCancel');

    const sizeSlider = document.getElementById('sizeSlider');
    const sizeValue = document.getElementById('sizeValue');

    const optTri = document.getElementById('optShowTriShrink');
    const triRow = document.getElementById('triShrinkRow');
    const triSlider = document.getElementById('triShrinkSlider');
    const triValue = document.getElementById('triShrinkValue');

    const optGap = document.getElementById('optShowGapScale');
    const gapRow = document.getElementById('gapScaleRow');
    const gapSlider = document.getElementById('xGapSlider');
    const gapValue = document.getElementById('xGapValue');

    const optExtra = document.getElementById('optShowExtra');
    const devRow = document.getElementById('devControlsRow');
    const debugCheckbox = document.getElementById('msDebugCheckbox');

    function openModal(){ modal.setAttribute('aria-hidden','false'); modal.style.display='grid'; }
    function closeModal(){ modal.setAttribute('aria-hidden','true'); modal.style.display='none'; }

    if (openBtn) openBtn.addEventListener('click', openModal);
    if (closeBtn) closeBtn.addEventListener('click', closeModal);
    if (cancelBtn) cancelBtn.addEventListener('click', closeModal);

    if (optTri) optTri.addEventListener('change', ()=> triRow.hidden = !optTri.checked);
    if (optGap) optGap.addEventListener('change', ()=> gapRow.hidden = !optGap.checked);
    if (optExtra) optExtra.addEventListener('change', ()=> devRow.hidden = !optExtra.checked);

    if (sizeSlider && sizeValue) {
      sizeValue.textContent = sizeSlider.value;
      sizeSlider.addEventListener('input', e => sizeValue.textContent = e.target.value);
    }
    if (triSlider && triValue) triSlider.addEventListener('input', e=> triValue.textContent = e.target.value);
    if (gapSlider && gapValue) gapSlider.addEventListener('input', e=> gapValue.textContent = Number(e.target.value).toFixed(2));

    if (applyBtn) applyBtn.addEventListener('click', ()=>{
      const size = Number(sizeSlider.value);
      document.getElementById('msRows').value = size;
      document.getElementById('msCols').value = size;
      closeModal();
      try { if (typeof window.startNewGame === 'function') window.startNewGame(); } catch(e){ console.warn(e); }
    });

    // accessibility
    document.addEventListener('keydown', (e)=> { if (e.key === 'Escape') closeModal(); });
  })();
  </script>
</body>
</html>
