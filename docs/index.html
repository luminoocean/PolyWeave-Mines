<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PolyWeave Mines — Minesweeper</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="controls" role="region" aria-label="Game controls">
    <div class="control-group">
      <label for="msRows">Rows</label>
      <input id="msRows" type="number" min="3" max="60" value="9" />
    </div>

    <div class="control-group">
      <label for="msCols">Cols</label>
      <input id="msCols" type="number" min="3" max="60" value="9" />
    </div>

    <div class="control-group">
      <label for="msMines">Mines</label>
      <input id="msMines" type="number" min="1" value="10" />
    </div>

    <div class="control-group">
      <label for="tilingSelect">Tiling</label>
      <select id="tilingSelect" aria-label="Tiling"></select>
    </div>

    <div class="control-group">
      <label for="adjacencySelect">Adjacency</label>
      <select id="adjacencySelect" aria-label="Adjacency"></select>
    </div>

    <div class="control-group">
      <button id="applyAdjacency" class="ms-btn">Apply adjacency</button>
      <button id="newGame" class="ms-btn primary">New Game</button>
    </div>

    <div style="margin-left:auto; display:flex; gap:8px; align-items:center;">
      <div id="msStatus">Ready</div>
      <button id="msSettingsBtn" class="ms-btn" title="Open settings">Settings</button>
    </div>
  </div>

  <main id="appRoot" role="main" aria-live="polite"></main>

  <!-- Settings modal -->
  <div id="msSettingsModal" class="ms-modal" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="ms-modal-panel" role="document">
      <header class="ms-modal-header">
        <h3>Display settings</h3>
        <button id="msSettingsClose" class="ms-close" aria-label="Close settings">✕</button>
      </header>

      <section class="ms-modal-body">
        <div class="ms-row">
          <label for="zoomSlider">Zoom</label>
          <input id="zoomSlider" type="range" min="0.5" max="2.0" step="0.01" value="1">
          <span id="zoomValue">1.00</span>
        </div>

        <div class="ms-row">
          <label for="xGapSlider">Horizontal gap</label>
          <input id="xGapSlider" type="range" min="0.5" max="2.0" step="0.01" value="1">
          <span id="xGapValue">1.00</span>
        </div>

        <div class="ms-row">
          <label for="yGapSlider">Vertical gap</label>
          <input id="yGapSlider" type="range" min="0.5" max="2.0" step="0.01" value="1">
          <span id="yGapValue">1.00</span>
        </div>

        <div class="ms-row">
          <label for="lightMode">Light mode</label>
          <input id="lightMode" type="checkbox" />
        </div>

        <div class="ms-row">
          <label for="debugToggle">Show debug overlay</label>
          <input id="debugToggle" type="checkbox" />
        </div>
      </section>

      <footer class="ms-modal-footer">
        <button id="msSettingsApply" class="ms-btn primary">Apply</button>
        <button id="msSettingsCancel" class="ms-btn">Cancel</button>
      </footer>
    </div>
  </div>

  <script src="app.js"></script>

  <script>
  (function(){
    const openBtn = document.getElementById('msSettingsBtn');
    const modal = document.getElementById('msSettingsModal');
    const closeBtn = document.getElementById('msSettingsClose');
    const applyBtn = document.getElementById('msSettingsApply');
    const cancelBtn = document.getElementById('msSettingsCancel');

    const zoomSlider = document.getElementById('zoomSlider');
    const zoomValue = document.getElementById('zoomValue');
    const xGapSlider = document.getElementById('xGapSlider');
    const xGapValue = document.getElementById('xGapValue');
    const yGapSlider = document.getElementById('yGapSlider');
    const yGapValue = document.getElementById('yGapValue');
    const lightBox = document.getElementById('lightMode');
    const debugBox = document.getElementById('debugToggle');

    function openModal(){ modal.setAttribute('aria-hidden','false'); modal.style.display='grid'; }
    function closeModal(){ modal.setAttribute('aria-hidden','true'); modal.style.display='none'; }

    if (openBtn) openBtn.addEventListener('click', openModal);
    if (closeBtn) closeBtn.addEventListener('click', closeModal);
    if (cancelBtn) cancelBtn.addEventListener('click', closeModal);

    if (zoomSlider && zoomValue){ zoomValue.textContent = zoomSlider.value; zoomSlider.addEventListener('input', e=> zoomValue.textContent = Number(e.target.value).toFixed(2)); }
    if (xGapSlider && xGapValue){ xGapValue.textContent = xGapSlider.value; xGapSlider.addEventListener('input', e=> xGapValue.textContent = Number(e.target.value).toFixed(2)); }
    if (yGapSlider && yGapValue){ yGapValue.textContent = yGapSlider.value; yGapSlider.addEventListener('input', e=> yGapValue.textContent = Number(e.target.value).toFixed(2)); }
    if (lightBox) lightBox.addEventListener('change', ()=> document.body.classList.toggle('light-mode', lightBox.checked));

    if (applyBtn) applyBtn.addEventListener('click', ()=>{
      closeModal();
      try { if (typeof window.renderTiledBoard === 'function') window.renderTiledBoard(); } catch(e){ console.warn(e); }
    });

    // accessibility
    document.addEventListener('keydown', (e)=> { if (e.key === 'Escape') closeModal(); });
  })();
  </script>
</body>
</html>
